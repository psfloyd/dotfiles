#!/bin/bash

#Option Selection#{{{

while : ; do
	case "$1" in
		-P|--progress) flagProg=true;;
		*) break
	esac
done
#}}}

# Vars{{{

dateVar=$(date +%F)
timeVar=$(date +%T)

logPath="$HOME/Other/.log/grive-loop-log/"
targetDir="$HOME/Documents/Google Drive"

logsToKeep=15

#}}}

# Script{{{

[ ! -d $logPath ] && mkdir -p $logPath

cd "$targetDir"
targetName=$(echo "$targetDir" | awk -F / '{ print $NF }')

if [ flagProg ]; then
	grive -P -l "$logPath"/"$targetName"'_'"$dateVar"'_'"$timeVar"".log"
else
	grive -l "$logPath"/"$targetName"'_'"$dateVar"'_'"$timeVar"".log"
fi

if [ $(ls "$logPath/" | grep '"$targetName".*.log' | wc -l) -gt $logsToKeep ]; then 
	rm "$logPath""$(ls "$logPath" -t | tail -1)" # Borro el archivo mas viejo
fi

#}}}
